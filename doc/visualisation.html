<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <title>Akka NWNR Atomic Register Visualisation (EFREI M1 Project 2020-2021)</title>
     <!--  <script src="d3.v3.min.js" charset="utf-8"></script> -->
  <script src="https://d3js.org/d3.v5.min.js" charset="utf-8"></script>
  <script src="../d3-msg-seq.js"></script>
  <script src="../log.js"></script>
  <script src="../log_console.js"></script>

  <style>
    code {
      font-size: 15px;
    }

    .column {
      padding: 5px;
    }

    .left {
      width: 45%;
    }

    .right {
      width: 55%;
    }

    .row {
      display: flex;
    }

    /* Clear floats after the columns */
    .row:after {
      content: "";
      display: table;
      clear: both;
    }

    #container {
      top: 50px;
    }

    text {
      font-family: sans-serif;
    }

    g.actor line {
      stroke: lightgray;
      stroke-width: 1px;
    }

    g.message text {
      font-family: monospace;
    }

    g.message line {
      stroke: black;
      stroke-width: 2px;
    }

    g.message path {
      stroke: black;
      stroke-width: 2px;
    }

    h2 {
      text-align: center;
    }
  </style>
</head>

<body>
  <div class="row">
    <div class="column left" style="background-color:#aaa;">
      <h2>Console Output</h2>
      <p>
        <code id="console_output">
        </code>
      </p>
    </div>

    <div class="column right" id="container" style="background-color:#bbb;">
      <h2>Message Sequence Chart</h2>
    </div>
  </div>

  <script>
    var msg_seq = d3.messageSequence().fade(0);

    document.getElementById("console_output").innerHTML = history_console;
    d3.select('#container')
      .append("svg")
      .attr("width", "100%")
      .attr("height", "300px")
      .call(msg_seq)

    function delay_add(messages) {
      var msg = messages.shift();
      if (msg) {
        msg_seq.addMessage(msg);
        setTimeout(function() {
          delay_add(messages)
        }, 500);
      }
    }

    var lines = history_messages.split("\n");
    var all_messages = [];
    for (var line in lines) {
      var elems = lines[line].split(";");
      all_messages.push({
        from: elems[0],
        to: elems[1],
        msg: elems[2]
      });
    }
    delay_add(all_messages);

    /*delay_add([{
        from: "customer",
        to: "barrista1",
        msg: "place order"
      },
      {
        from: "barrista1",
        to: "register",
        msg: "enter order"
      },
      {
        from: "register",
        to: "barrista1",
        msg: "give total"
      },
      {
        from: "barrista1",
        to: "barrista1",
        msg: "get cup"
      },
      {
        from: "barrista1",
        to: "barrista2",
        msg: "give cup"
      },
      {
        from: "barrista1",
        to: "customer",
        msg: "request money"
      },
      {
        from: "customer",
        to: "barrista1",
        msg: "pay order"
      },
      {
        from: "barrista2",
        to: "barrista2",
        msg: "get chai mix"
      },
      {
        from: "barrista2",
        to: "barrista2",
        msg: "add flavor"
      },
      {
        from: "barrista2",
        to: "barrista2",
        msg: "add milk"
      },
      {
        from: "barrista2",
        to: "barrista2",
        msg: "add ice"
      },
      {
        from: "barrista2",
        to: "barrista2",
        msg: "swirl"
      },
      {
        from: "barrista2",
        to: "customer",
        msg: "give tasty beverage"
      },
      {
        from: "customer",
        to: "tasty beverage",
        msg: "sip"
      },
      {
        from: "tasty beverage",
        to: "customer",
        msg: "burn"
      },
      {
        from: "customer",
        to: "customer",
        msg: "cry"
      },
      {
        from: "customer",
        to: "manager",
        msg: "complain"
      },
      {
        from: "manager",
        to: "barrista1",
        msg: "fire"
      },
      {
        from: "manager",
        to: "barrista2",
        msg: "fire"
      },
    ])*/
  </script>
</body>

</html>
